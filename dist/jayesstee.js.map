{"version":3,"sources":["../src/jayesstee.js"],"names":["jst","selectorOrElement","HTMLElement","JstElement","el","document","querySelector","globalJstObjectId","globalJstObjectClassId","globalJstElementId","JstObject","companionObj","_jstId","_companionObj","_renderFunc","undefined","_forms","_wasRendered","_jstEl","_refCount","updateWithParent","constructor","prototype","_jstClassIds","name","_jstClassId","_classPrefix","_fullPrefix","_type","getName","getFullPrefix","styleManager","removeCss","opts","isParentUpdate","css","renderCss","updateCss","items","_render","newJst","type","getType","_processParams","_compareAndCopy","_unrender","isDomified","dom","Promise","resolve","then","_postRender","html","refresh","render","Error","postRender","unrender","delete","destroy","someCss","rawCss","_normalizeCss","renderFunc","jstElement","attrs","id","setJstElement","JstFormManager","form","getValues","refName","val","JstStyle","classPrefix","className","cssGlobal","cssLocal","cssInstance","fullPrefix","processedCss","_processCss","map","Object","values","instance","$style","item","typeInfo","prefix","block","push","_stringify","text","keys","selector","atRuleRule","match","rules","scopedSelector","replace","_stringifyObj","obj","indent","toString","prop","attr","m","toLowerCase","reduce","acc","rgbaString","substr","JstStyleManager","jstStyleLookup","jstStyles","jstObj","getClassPrefix","jstStyle","madeNew","_addStyle","_removeStyle","index","entry","splice","inputs","Array","isArray","vals","input","checked","value","tag","params","contents","props","events","tagName","arguments","innerHTML","atts","appendChild","apply","lastJstObject","depth","repeat","attrName","p1","p2","_quoteAttrValue","length","join","console","warn","lastJstForm","error","createElement","ref","setRef","addForm","addInput","jstObject","setAttribute","propName","event","addEventListener","listener","nextEl","contentsStack","sanity","debug","log","hasEl","childEl","insertBefore","createTextNode","stackItem","pop","_deleteItem","parentNode","removeChild","topNode","forceUpdate","level","oldIndex","newIndex","removeAttribute","fixProps","i","eventName","removeEventListener","oldItem","newItem","doReplace","textContent","oldStartIndex","itemsToDelete","newItems","itemToDelete","contentsItem","isUpdate","_flatten","param","jstoptions","properties","Function","fn","extend","target","options","copy","tagPrefix","Form","Element","tags","cssFuncs","cssUnits","addCustomElements","names","fullName","args","addCssFunctions","camelName","toUpperCase","addCssUnits","fixed","arg","object","$jst","makeGlobal","global","globalTagPrefix","g","window","if","ifTrue","ifFalse","setDebug","_init","_addCssUnit","unit","flat","result","evenFlatter","concat","_normalizeCssObject","atRules","Set","sel","fixedSetting","has","processed","assign","parts","split","shift","part","setting","_normalizeCssStyles","tmpObj","rgb","string","fixedObj"],"mappings":"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","file":"jayesstee.js","sourcesContent":["// Jayesstee (JST) is a pure javascript HTML templating\n// library, that lets you build HTML (and insert into the DOM)\n// using functional javascript \n//\n// Copyright 2018 Edward Funnekotter All rights reserved\n\nexport function jst(selectorOrElement) {\n  if (selectorOrElement instanceof HTMLElement) {\n    return new JstElement(selectorOrElement);\n  }\n  else {\n    let el = document.querySelector(selectorOrElement);\n    if (!el) {\n      return new JstElement();\n    }\n    else {\n      return new JstElement(el);\n    }\n  }\n}\n \nexport default jst;\n\n// Some global unique identifiers\nlet globalJstObjectId       = 1;\nlet globalJstObjectClassId  = 1;\nlet globalJstElementId      = 1;\n\n// JstObject Class\n//\n// This class is a base class for all classes that are\n// renderable within jayesstee. For a user-defined class to\n// be successfully redered, it must extend this class and\n// implement the render() method\n//\n// It can also be used as a companion object for generic\n// objects. Calling jst.object(someObj) will return one of these\n// objects that is linked to someObj (someObj.$jst is this object and\n// this.companionObj is the passed in object).\nexport class JstObject {\n  constructor(companionObj) {\n    this._jstId           = globalJstObjectId++;\n    this._companionObj    = companionObj;\n    this._renderFunc      = undefined;\n    this._forms           = {};\n    this._wasRendered     = false;\n    this._jstEl           = undefined;\n    this._refCount        = 0;\n    this.updateWithParent = false;\n\n    // TODO - there must be a better way to do this\n    // Note that orginally, it just stored the _jstClassId directly\n    // on this.constructor.prototype, but that resulted in parent classes ending up\n    // with the same ID as the child (e.g. InputButton -> Input -> JstObject,\n    // InputButton and Input got the same ID)\n    if (!this.constructor.prototype._jstClassIds) {\n      this.constructor.prototype._jstClassIds = {};\n    }\n    if (!this.constructor.prototype._jstClassIds[this.constructor.name]) {\n      this.constructor.prototype._jstClassIds[this.constructor.name] = globalJstObjectClassId++;\n    }\n\n    this._jstClassId = this.constructor.prototype._jstClassIds[this.constructor.name];\n\n    this._classPrefix     = `jsto${this._jstClassId}-`;\n    this._fullPrefix      = `jsto${this._jstClassId}-i${this._jstId}-`;\n    this._type            = `${this.getName()}-${this.getFullPrefix()}`;\n\n  }\n\n  destroy() {\n    jst.styleManager.removeCss(this);\n  }\n\n  // Refresh the instantiation of this object\n  // Should be called after dependent data is changed\n  refresh(opts) {\n\n    let isParentUpdate = opts ? opts.isParentUpdate : false;\n    \n    if (!isParentUpdate && !this._jstEl) {\n      return;\n    }\n    \n    // Gather all the styles for this object\n    let css     = this.renderCss(opts);\n    if (css) {\n      jst.styleManager.updateCss(this, css);\n    }\n\n    this._refCount++;\n    // console.warn(\"refresh:\", this._type, this._refCount);\n    if (!this._jstEl && isParentUpdate ||\n        (isParentUpdate && this.updateWithParent) ||\n        !isParentUpdate\n       ) {\n    \n      // Create a new JST tree that will be compared against the existing one\n      let items   = this._render();\n\n      // newJst will contain the new updated tree\n      let newJst = new JstElement(\"jstobject\", [{type: this.getType()}]);\n      newJst._processParams([items], true);\n\n      if (this._jstEl){\n        // Compare with the existing tree to find what needs to change\n        this._jstEl._compareAndCopy(newJst, true, this, false, 0);\n        // Need to call unrender to decrement the refcount for the temp\n        // object\n        this._unrender();\n      }\n      else {\n        this._jstEl = newJst;\n      }\n      \n      // If we were already domified, then redo it for the new elements\n      if (this._jstEl.isDomified) {\n        this._jstEl.dom(this);\n      }\n\n      Promise.resolve().then(() => this._postRender());\n      \n    }\n    \n  }\n\n  html() {\n    if (this._jstEl) {\n      return this._jstEl.html();\n    }\n    else {\n      this.refresh({isParentUpdate: true});\n      return this._jstEl.html();\n    }\n  }\n\n  // Internally called render function - will call publically\n  // available one \n  _render() {\n    let items = this.render();\n    this._wasRendered = true;\n    return items;\n  }\n\n  // Called automatically on instantiation or refresh\n  // This must be overrided in classes inheriting from JstObject\n  render() {\n    if (!this._renderFunc) {\n      if (this._companionObj) {\n        throw(new Error(\"You must define a render function with .fill()\"));\n      }\n      else {\n        throw(new Error(\"You must override render() in descendant classes\"));\n      }\n    }\n    else {\n      return this._renderFunc(this._companionObj);\n    }\n  }\n\n  // Internally called postRender function\n  _postRender() {\n    this.postRender();\n  }\n\n  // Empty base class for postRender - sub classes can override\n  postRender() {\n  }\n\n  // Called when a parent no longer wants this object's tree in the DOM\n  _unrender() {\n    this._refCount--;\n    // console.warn(\"unrender:\", this._type, this._refCount);\n    if (this._refCount < 0) {\n      throw new Error(\"Invalid ref count in jstobject\", this);\n    }\n    if (this._refCount == 0) {\n      this.unrender();\n      if (this._jstEl) {\n        this._jstEl.delete();\n        delete(this._jstEl);\n      }\n      this.destroy();\n    }\n  }\n\n  // Can be overrided in the sub class \n  unrender() {\n  }\n\n  // Called automatically on instantiation or full refresh\n  renderCss() {\n    let css = {};\n    let someCss = false;\n    for (let type of ['cssGlobal', 'cssLocal', 'cssInstance']) {\n      if (this[type]) {\n        let rawCss = this[type]();\n        if (rawCss) {\n          css[type] = jst._normalizeCss(rawCss);\n          someCss = true;\n        }\n      }\n    }\n    return someCss ? css : undefined;\n  }\n\n  getWasRendered() {\n    return this._wasRendered;\n  }\n\n  getClassPrefix() {\n    return this._classPrefix;\n  }\n\n  getFullPrefix() {\n    return this._fullPrefix;\n  }\n\n  getUpdateWithParent() {\n    return this.updateWithParent;\n  }\n\n  // Used to specify the render behaviour for a generic object that\n  // has been linked through jst.object(<object>)\n  fill(renderFunc) {\n    if (typeof(renderFunc) !== \"function\") {\n      throw(new Error(\".fill() expects a function to be passed in\"));\n    }\n\n    this._renderFunc = renderFunc;\n    \n    return this;\n  }\n\n  getName() {\n    return this.constructor.name;\n  }\n\n  getType() {\n    return this._type;\n  }\n\n  addForm(jstElement) {\n    let name = jstElement.attrs.name || jstElement.attrs.id || \"_unnamed_\";\n\n    if (this._forms[name]) {\n      this._forms[name].setJstElement(jstElement);\n    }\n    else {\n      this._forms[name] = new JstFormManager(jstElement);\n    }\n    return this._forms[name];\n  }\n\n  getFormValues(name) {\n    let form = this._forms[name || \"_unnamed_\"];\n    return form ? form.getValues() : {};\n  }\n\n  // Internal function to record the reference name\n  setRef(refName, val) {\n    if (this._companionObj) {\n      this._companionObj[refName] = val;\n    }\n    else {\n      this[refName] = val;\n    }\n  }\n\n  // Get file, line and column info\n  _getCodeLocation() {\n    \n  }\n}\n\n\n// JstStyle Class\n//\n// This renders a single style block\nclass JstStyle extends JstObject {\n  constructor(classPrefix, className) {\n    super();\n    this.classPrefix = classPrefix;\n    this.className   = className;\n    this.css         = {\n      cssGlobal:   [],\n      cssLocal:    [],\n      cssInstance: {}\n    };\n  }\n\n  updateCss(fullPrefix, css) {\n    let processedCss = this._processCss(fullPrefix, css);\n    this.css.cssGlobal = processedCss.cssGlobal;\n    this.css.cssLocal  = processedCss.cssLocal;\n\n    if (!this.css.cssInstance) {\n      this.css.cssInstance = {};\n    }\n    this.css.cssInstance[fullPrefix] = processedCss.cssInstance;\n    this.refresh();\n  }\n\n  removeCss(fullPrefix) {\n    if (this.css.cssInstance[fullPrefix]) {\n      delete(this.css.cssInstance[fullPrefix]);\n      this.refresh();\n    }\n  }\n\n  render() {\n    return [\"cssGlobal\", \"cssLocal\", \"cssInstance\"].map(\n      type => {\n        if (this.css && this.css[type]) {\n          if (type === \"cssInstance\") {\n            return Object.values(this.css.cssInstance).map(\n              instance => instance.map(item => jst.$style(item)));\n          }\n          else {\n            return this.css[type].map(item => {\n              return jst.$style(item);\n            });\n          }\n        }\n        return undefined;\n      }\n    );\n  }\n\n  // Override the type to put more useful info\n  getType() {\n    return `${this.getName()}-${this.className}`;\n  }\n\n  // Go through the new CSS and either update existing CSS or\n  // replace what is there, if changed \n  _processCss(fullPrefix, css) {\n    let processedCss = {};\n    for (let typeInfo of [\n      [\"cssGlobal\"               ],\n      [\"cssLocal\",    this.classPrefix],\n      [\"cssInstance\", fullPrefix ]\n    ]) {\n      let type   = typeInfo[0];\n      let prefix = typeInfo[1];\n\n      processedCss[type] = [];\n      \n      if (css[type]) {\n        for (let block of css[type]) {\n          if (block) {\n            processedCss[type].push(this._stringify(prefix, block));\n          }\n        }\n      }\n    }\n    return processedCss;\n  }\n\n  // Stringify the CSS into blocks suitable for insertion into the DOM\n  _stringify(prefix, block) {\n    let text = \"\";\n    for(let selector of Object.keys(block)) {\n      let atRuleRule;\n      if (selector.match(/^@/)) {\n        atRuleRule = block[selector][\":rule\"];\n        delete(block[selector][\":rule\"]);\n      }\n      \n      let rules = block[selector];\n      if (typeof(atRuleRule) != \"undefined\") {\n        text += `${selector} ${atRuleRule} {\\n`;\n        text += this._stringify(prefix, rules);\n        text += `}\\n`;\n      }\n      else {\n        let scopedSelector = prefix ? selector.replace(/([\\.#])/g, `$1${prefix}`) : selector;\n        text += `${scopedSelector} `;\n        text += this._stringifyObj(rules, \"\");\n      }\n    }\n    return text;\n  }\n\n  _stringifyObj(obj, indent) {\n    if (!(obj instanceof Object)) {\n      if (typeof obj !== \"undefined\" && obj.toString) {\n        return obj.toString();\n      }\n      else {\n        return \"\";\n      }\n    }\n    let text = \"{\\n\";\n    for (let prop of Object.keys(obj)) {\n      let val = obj[prop];\n      let attr = prop.replace(/([A-Z])/g, m => \"-\"+m.toLowerCase());\n      val = val.reduce ? val.reduce((acc, item) =>\n                                    acc + \" \" + this._stringifyObj(item, indent + \"  \"), \"\") :\n        val.rgbaString ? val.rgbaString : val.toString();\n      val = val.replace(/\\s+/, \" \");\n      if (val.substr(-2,1) !== \"}\") {\n      text += `${indent}  ${attr}: ${val};\\n`;\n      }\n      else {\n        text += `${indent}  ${attr} ${val}`;\n      }\n    }\n    text += `${indent}}\\n`;\n    return text;\n  }\n  \n}\n\n\n// JstStyleManager Class\n//\n// This class defines the singletone that manages the set of style elements\n// that are inserted for application created CSS\nclass JstStyleManager extends JstObject {\n  constructor() {\n    super();\n    this.jstStyleLookup = {};\n    this.jstStyles      = [];\n  }\n\n  render() {\n    return this.jstStyles;\n  }\n  \n  updateCss(jstObj, css) {\n    let classPrefix = jstObj.getClassPrefix();\n    let fullPrefix  = jstObj.getFullPrefix();\n\n    let jstStyle    = this.jstStyleLookup[classPrefix];\n\n    let madeNew = false;\n    if (!jstStyle) {\n      jstStyle = new JstStyle(classPrefix, jstObj.getName());\n      madeNew = true;\n    }\n\n    jstStyle.updateCss(fullPrefix, css);\n\n    if (madeNew) {\n      this._addStyle(jstStyle, classPrefix);\n    }\n    else {\n      jstStyle.refresh();\n    }\n    \n  }\n\n  removeCss(jstObj) {\n    let classPrefix = jstObj.getClassPrefix();\n    let fullPrefix  = jstObj.getFullPrefix();\n\n    let jstStyle    = this.jstStyleLookup[classPrefix];\n\n    if (jstStyle) {\n      jstStyle.removeCss(fullPrefix);\n      this._removeStyle(jstStyle, classPrefix);\n    }\n  }\n\n  _addStyle(jstStyle, classPrefix) {\n    this.jstStyles.push(jstStyle);\n    this.jstStyleLookup[classPrefix] = jstStyle;\n    this.refresh();\n  }\n\n  _removeStyle(jstStyle, classPrefix) {\n    // TODO - need some sort of ref counting of\n    // users of local styles so they can be removed\n    // when last user is gone\n    return;\n    let index = 0;\n    for (let entry of this.jstStyles) {\n      if (jstStyle === entry) {\n        this.jstStyles.splice(index, 1);\n        delete(this.jstStyleLookup[classPrefix]);\n        break;\n      }\n      index++;\n    }\n    this.refresh();\n  }\n\n}\n\n\n\n// JstFormManager Class\n//\n// Holds some information about forms\nclass JstFormManager {\n  constructor(jstElement) {\n    this.jstElement = jstElement;\n    this.inputs     = {};\n  }\n\n  addInput(jstElement) {\n    let name = jstElement.attrs.name || jstElement.attrs.id;\n    if (name) {\n      if (this.inputs[name]) {\n        if (Array.isArray(this.inputs[name])) {\n          this.inputs[name].push(jstElement);\n        }\n        else {\n          this.inputs[name] = [this.inputs[name], jstElement];\n        }\n      }\n      else {\n        this.inputs[name] = jstElement;\n      }\n    }\n  }\n\n  setJstElement(jstElement) {\n    this.jstElement = jstElement;\n  }\n\n  getValues() {\n    let vals = {};\n    for (let name of Object.keys(this.inputs)) {\n      if (Array.isArray(this.inputs[name])) {\n        if (this.inputs[name][0].attrs.type &&\n            (this.inputs[name][0].attrs.type.toLowerCase() === \"radio\" ||\n             this.inputs[name][0].attrs.type.toLowerCase() === \"checkbox\")) {\n          for (let input of this.inputs[name]) {\n            if (input.el.checked) {\n              if (typeof input.attrs.value === 'undefined') {\n                vals[name] = input.attrs.id;\n              }\n              else {\n                vals[name] = input.attrs.value;\n              }\n            }\n          }\n        }\n        else {\n          vals[name] = this.inputs[name][0].el.value;\n        }\n      }\n      else {\n        vals[name] = this.inputs[name].el.value;\n      }\n    }\n    return vals;\n  }\n  \n}\n\n\n// JstElement Class\n//\n// This class represents an HTML element. On creation\n// it is just a scaffold that can be either inserted into\n// the DOM (in a browser) or serialized into HTML.\nclass JstElement {\n  constructor(tag, params) {\n    this.id       = globalJstElementId++;\n    this.contents = [];\n    this.attrs    = {};\n    this.props    = [];\n    this.events   = {};\n    this.opts     = {};\n\n    if (tag instanceof HTMLElement) {\n      // Wrapping an element with a JstElement\n      this.tag = tag.tagName.toLowerCase();\n      this.el  = tag;\n    }\n    else {\n      this.tag = tag.toLowerCase();\n    }\n\n    this._processParams(params);\n\n    if (this.el) {\n      // If we have a real element, put all the content into it\n      this.dom();\n    }\n  }\n\n  appendChild() {\n    this.isDomified = false;\n\n    this._processParams(arguments);\n    if (this.el) {\n      this.dom();\n    }\n  }\n\n  replaceChild() {\n    if (this.el) {\n      this.el.innerHTML = \"\";\n    }\n\n    this.isDomified = false;\n    this.contents   = [];\n    this.atts       = [];\n    this.props      = [];\n\n    this.appendChild.apply(this, arguments);\n  }\n\n  // Return HTML\n  html(opts, lastJstObject) {\n    let html = \"\";\n\n    if (!opts)       { opts = {}; }\n    if (!opts.depth) { opts.depth = 0; }\n    if (opts.indent) { html += \" \".repeat(opts.indent * opts.depth++); }\n\n    html += \"<\" + this.tag;\n\n    let attrs = [];\n    for (let attrName of Object.keys(this.attrs)) {\n      let val = this.attrs[attrName];\n      if (lastJstObject && (attrName === \"class\" || attrName === \"id\") && val.match && val.match(/(^|\\s)-/)) {\n        val = val.replace(/(^|\\s)(--?)/g, (m, p1, p2) => p1 + (p2 === \"-\" ? lastJstObject.getClassPrefix() : lastJstObject.getFullPrefix()));\n      }\n      attrs.push(attrName + \"=\" + \"\\\"\" + this._quoteAttrValue(val) + \"\\\"\");\n    }\n    if (attrs.length) {\n      html += \" \" + attrs.join(\" \");\n    }\n    if (this.props.length) {\n      html += \" \" + this.props.join(\" \");\n    }\n\n    html += \">\";\n\n    if (opts.indent) {\n      html += \"\\n\";\n    }\n\n    for (let item of this.contents) {\n      if (item.type === \"jst\") {\n        html += item.value.html(opts, lastJstObject);\n      }\n      else if (item.type === \"obj\" && item.value._jstEl) {\n        html += item.value._jstEl.html(opts, item.value);\n      }\n      else if (item.type === \"HTMLElement\") {\n        html += item.value.innerHTML;\n      }\n      else if (item.type === \"textnode\") {\n        if (opts.indent && opts.depth) {\n          html += \" \".repeat(opts.indent * opts.depth);\n        }\n        html += item.value;\n        if (opts.indent && opts.depth) {\n          html += \"\\n\";\n        }\n      }\n      else {\n        console.warn(\"Unexpected content type while serializing:\", item.type);\n      }\n    }\n\n    if (opts.indent && opts.depth) {\n      opts.depth--;\n      html += \" \".repeat(opts.indent * opts.depth);\n    }\n\n    html += `</${this.tag}>`;\n    if (opts.indent) {\n      html += \"\\n\";\n    }\n    return html;\n  }\n\n  // Instantiate into the DOM and return the HTMLElement\n  dom(lastJstObject, lastJstForm) {\n    // console.warn(\"Domming:\", this.tag, this.attrs.class, lastJstObject);\n\n    // TEMP protection...\n    if (this.tag === \"-deleted-\") {\n      console.error(\"Trying to DOM a deleted element\", this);\n      return;\n    }\n    let el = this.el || document.createElement(this.tag);\n\n    if (this.ref && lastJstObject) {\n      lastJstObject.setRef(this.ref, this);\n    }\n\n    // Handle forms\n    if (lastJstObject && this.tag === \"form\" && (this.attrs.name || this.attrs.id)) {\n      lastJstForm = lastJstObject.addForm(this);\n    }\n    else if (lastJstForm &&\n             (this.tag === \"input\" ||\n              this.tag === \"textarea\" ||\n              this.tag === \"select\")) {\n      lastJstForm.addInput(this);\n    }\n\n    if (!this.isDomified) {\n      \n      this.jstObject = lastJstObject;\n      \n      for (let attrName of Object.keys(this.attrs)) {\n        let val = this.attrs[attrName];\n        if (lastJstObject && (attrName === \"class\" || attrName === \"id\") && val.match && val.match(/(^|\\s)-/)) {\n          val = val.replace(/(^|\\s)(--?)/g, (m, p1, p2) => p1 + (p2 === \"-\" ? lastJstObject.getClassPrefix() : lastJstObject.getFullPrefix()));\n        }\n        el.setAttribute(attrName, val);\n      }\n      for (let propName of this.props) {\n        el[propName] = true;\n      }\n      for (let event of Object.keys(this.events)) {\n        // TODO: Add support for options - note that this will require\n        //       some detection of options support in the browser...\n        el.addEventListener(event, this.events[event].listener);\n      }\n    }\n\n    let nextEl;\n    let contentsStack = [];\n    let index         = this.contents.length - 1;\n    let contents      = this.contents;\n    let sanity        = 100000000;\n    if (index >= 0) {\n      while (sanity--) {\n        let item = contents[index];\n        let jstObj = lastJstObject;\n        if (item.type === \"jst\" || item.type === \"obj\") {\n          if (0 && !jst.debug && item.value._jstEl &&\n               item.value._jstEl.contents.length) {\n            console.log(\"Here: \", item);\n            // TODO - note that stuff changed with lastJstObject (introduced jstObj)\n            // Work on jstobject's items instead\n            if (index) {\n              contentsStack.push([index - 1, contents, lastJstObject]);\n            }\n            contents      = item.value._jstEl.contents;\n            index         = contents.length - 1;\n            lastJstObject = item.value;            \n            continue;\n          }\n          else if (item.type === \"obj\") {\n            jstObj = item.value;\n            if (item.value._jstEl) {\n              item = {value: item.value._jstEl, type: \"jst\"};\n            }\n          } \n          let hasEl   = item.value.el; \n          let childEl = item.value.dom(jstObj, lastJstForm);\n          if (!hasEl) {\n            if (nextEl) {\n              el.insertBefore(childEl, nextEl);\n            }\n            else {\n              el.appendChild(childEl);\n            }\n          }\n          nextEl = childEl;\n        }\n        else if (item.type === \"textnode\") {\n          if (!item.el) {\n            item.el = document.createTextNode(item.value);\n            if (nextEl) {\n              el.insertBefore(item.el, nextEl);\n            }\n            else {\n              el.appendChild(item.el);\n            }\n          }\n          nextEl = item.el;\n        }\n        else {\n          console.warn(\"Unexpected content type while dominating:\", item.type);\n        }\n\n        if (!index) {\n          if (contentsStack.length) {\n            let stackItem = contentsStack.pop();\n            index         = stackItem[0];\n            contents      = stackItem[1];\n            lastJstObject = stackItem[2];\n          }\n          else {\n            break;\n          }\n        }\n        else {\n          index--;\n        }\n      }        \n    }\n\n    this.el         = el;\n    this.isDomified = true;\n    return el;\n  }\n\n  // Delete this element and remove from the DOM if there\n  delete() {\n    // Remove all items associated with this JstElement\n    for (let item of this.contents) {\n      this._deleteItem(item);\n    }\n\n    // Remove any reference to the JstObject (circular reference)\n    delete this.jstObject;\n\n    // Delete this element, if present\n    if (this.el) {\n      if (this.el.parentNode) {\n        this.el.parentNode.removeChild(this.el);\n      }\n    }\n\n    delete this.el;\n\n    this.tag      = \"-deleted-\";\n    this.contents = [];\n    this.attrs    = {};\n    this.props    = [];\n  }\n\n  // Takes a new Jst tree and will do a full comparison to find the differences\n  // which will then be copied into the real tree in preparation for changing\n  // the DOM \n  // Returns true if upper layer needs to copy new Jst. False otherwise\n  _compareAndCopy(newJst, topNode, jstObject, forceUpdate, level) {\n    let oldIndex = 0;\n    let newIndex = 0;\n\n    // console.log(\"CAC>\" + \" \".repeat(level*2), this.tag + this.id, newJst.tag+newJst.id);\n    \n    // First check the attributes, props and events\n    // But only if we aren't the topNode\n    if (!topNode) {\n      if (forceUpdate || this.opts.forceUpdate || this.tag !== newJst.tag) {\n        return true;\n      }\n\n      // Blindly copy the JST options\n      this.opts = newJst.opts;\n      \n      // Just fix all the attributes inline\n      for (let attrName of Object.keys(this.attrs)) {\n        if (!newJst.attrs[attrName]) {\n          delete this.attrs[attrName];\n          if (this.isDomified) {\n            this.el.removeAttribute(attrName);\n          }\n        }\n        else if (newJst.attrs[attrName] !== this.attrs[attrName]) {\n          this.attrs[attrName] = newJst.attrs[attrName];\n          if (this.isDomified) {\n            //refactor\n            let val = newJst.attrs[attrName];\n            if (this.jstObject && (attrName === \"class\" || attrName === \"id\") && val.match(/(^|\\s)-/)) {\n              val = val.replace(/(^|\\s)(--?)/g, (m, p1, p2) => p1 + (p2 === \"-\" ?\n                                                                     this.jstObject.getClassPrefix() :\n                                                                     this.jstObject.getFullPrefix()));\n            }\n            this.el.setAttribute(attrName, val);\n          }\n        }\n      }\n      for (let attrName of Object.keys(newJst.attrs)) {\n        if (!this.attrs[attrName]) {\n          this.attrs[attrName] = newJst.attrs[attrName];\n          if (this.isDomified) {\n            //refactor\n            let val = newJst.attrs[attrName];\n            if (this.jstObject && (attrName === \"class\" || attrName === \"id\") && val.match(/(^|\\s)-/)) {\n              val = val.replace(/(^|\\s)(--?)/g, (m, p1, p2) => p1 + (p2 === \"-\" ?\n                                                                     this.jstObject.getClassPrefix() :\n                                                                     this.jstObject.getFullPrefix()));\n            }\n            this.el.setAttribute(attrName, val);\n          }\n        }\n      }\n\n      if (this.props.length || newJst.props.length) {\n        let fixProps = false;\n        \n        // Just compare them in order - if they happen to be the same,\n        // but in a different order, we will do a bit more work than necessary\n        // but it should be very unlikely that that would happen\n        if (this.props.length != newJst.props.length) {\n          fixProps = true;\n        }\n        else {\n          for (let i = 0; i < this.props.length; i++) {\n            if (this.props[i] !== newJst.props[i]) {\n              fixProps = true;\n              break;\n            }\n          }\n        }\n        \n        if (fixProps) {\n          if (this.isDomified) {\n            for (let prop of this.props) {\n              delete this.el[prop];\n            }\n            for (let prop of newJst.props) {\n              this.el[prop] = true;\n            }\n          }\n          this.props = newJst.props;\n        }\n      }\n      \n      // Fix all the events\n      for (let eventName of Object.keys(this.events)) {\n        if (!newJst.events[eventName]) {\n          if (this.isDomified) {\n            this.el.removeEventListener(eventName, this.events[eventName].listener);\n          }\n          delete this.events[eventName];\n        }\n        else if (newJst.events[eventName].listener !== this.events[eventName].listener) {\n          if (this.isDomified) {\n            this.el.removeEventListener(eventName, this.events[eventName].listener);\n            this.el.addEventListener(eventName, newJst.events[eventName].listener);\n          }\n          this.events[eventName] = newJst.events[eventName];\n        }\n      }\n      for (let eventName of Object.keys(newJst.events)) {\n        if (!this.events[eventName]) {\n          this.events[eventName] = newJst.events[eventName];\n          if (this.isDomified) {\n            this.el.addEventListener(eventName, newJst.events[eventName].listener);\n          }\n        }\n      }\n    }\n\n    if (!forceUpdate && !this.opts.forceUpdate) {\n      while (true) {\n        let oldItem = this.contents[oldIndex];\n        let newItem = newJst.contents[newIndex];\n\n        if (!oldItem || !newItem) {\n          break;\n        }\n\n        if (oldItem.type !== newItem.type) {\n          break;\n        }\n\n        if (oldItem.type === \"jst\") {\n          // If the tags are the same, then we must descend and compare\n          let doReplace = oldItem.value._compareAndCopy(newItem.value, false, undefined, undefined, level+1);\n          if (doReplace) {\n            break;\n          }\n        }\n        else if (oldItem.type === \"obj\") {\n          // If the tags are the same, then we must descend and compare\n          if (oldItem.value._jstId != newItem.value._jstId) {\n            // Different JstObjects\n            break;\n          }\n          // Don't bother descending into JstObjects - they take care of themselves\n        }\n        else if (oldItem.type === \"textnode\" && oldItem.value !== newItem.value) {\n          if (oldItem.el) {\n            oldItem.el.textContent = newItem.value;\n          }\n          oldItem.value = newItem.value;\n        }\n\n        oldIndex++;\n        newIndex++;\n        \n        if (newItem.type === \"obj\") {\n          // Unhook this reference\n          newItem.value._unrender();\n        }\n      }\n    }\n    \n    // Need to copy stuff - first delete all the old contents\n    let oldStartIndex = oldIndex;\n    let oldItem       = this.contents[oldIndex];\n    let itemsToDelete = [];\n\n    while (oldItem) {\n      // console.log(\"CAC>  \" + \" \".repeat(level*2), \"deleting old item :\", oldItem);\n      itemsToDelete.push(oldItem);\n      oldIndex++;\n      oldItem = this.contents[oldIndex];\n    }\n\n    this.contents.splice(oldStartIndex, oldIndex - oldStartIndex);\n\n    if (newJst.contents[newIndex]) {\n      // Remove the old stuff and insert the new\n      let newItems = newJst.contents.splice(newIndex, newJst.contents.length - newIndex);\n      // console.log(\"CAC>  \" + \" \".repeat(level*2), \"new items being added:\", newItems);\n      this.contents.splice(oldStartIndex, 0, ...newItems);\n    }\n\n    for (let itemToDelete of itemsToDelete) {\n      this._deleteItem(itemToDelete);\n    }\n\n    // console.log(\"CAC>\" + \" \".repeat(level*2), \"/\" + this.tag+this.id);\n    return false;\n    \n  }\n\n  _deleteItem(contentsItem) {\n    if (contentsItem.type === \"jst\") {\n      contentsItem.value.delete();\n    }\n    else if (contentsItem.type === \"obj\") {\n      contentsItem.value._unrender();\n    }\n    else if (contentsItem.type === \"textnode\") {\n      if (contentsItem.el && contentsItem.el.parentNode) {\n        // Remove the span element\n        contentsItem.el.parentNode.removeChild(contentsItem.el);\n        delete contentsItem.el;\n      }\n    }\n    else {\n      console.warn(\"Unexpected content type while deleting:\", contentsItem.type);\n    }\n  }\n\n  // This is the meat of all of JST - it is what takes a list of arguments to\n  // a jst element (e.g. jst.$div(...)) and converts it into something that represents\n  // a tree of nodes. The passed in params can be a list of lists (will be flattened),\n  // an object (converted to attributes), strings, numbers, booleans (coverted to textnodes)\n  // or other JST objects. If you understand what is going on here, then you really\n  // understand what JST is all about\n  _processParams(params, isUpdate) {\n    params = jst._flatten.apply(this, params);\n    if (typeof params === \"undefined\") {\n      params = [];\n    }\n\n    for (let param of params) {\n      let type = typeof param;\n\n      if (param === null) {\n        // Do nothing\n      }\n      else if (type === \"number\" || type === \"string\") {\n        this.contents.push({type: \"textnode\", value: param});\n      }\n      else if (type === \"boolean\") {\n        this.contents.push({type: \"textnode\", value: param.toString()});\n      }\n      else if (param instanceof JstObject) {\n\n        // Put the JstObject into this element's contents\n        this.contents.push({type: \"obj\", value: param});\n\n        // Let the JstObject render itself\n        param.refresh({isParentUpdate: true});\n        \n      }\n      else if (param instanceof JstElement) {\n        this.contents.push({type: \"jst\", value: param});\n      }\n      else if (typeof HTMLElement !== 'undefined' && param instanceof HTMLElement) {\n        this.contents.push({type: \"jst\", value: new JstElement(param)});\n      }\n      else if (type === \"object\") {\n        for (let name of Object.keys(param)) {\n          if (typeof(param[name]) === \"undefined\") {\n            param[name] = \"\";\n          }\n          if (name === \"jstoptions\" && param.jstoptions instanceof Object) {\n            this.opts = param.jstoptions;\n          }\n          else if (name === \"properties\" && param.properties instanceof Array) {\n            for (let prop of param.properties) {\n              this.props.push(prop);\n            }\n          }\n          else if (name === \"events\" && typeof param.events === \"object\") {\n            for (let event of Object.keys(param.events)) {\n              if (param.events[event] instanceof Function) {\n                this.events[event] = {listener: param.events[event]};\n              }\n              else {\n                this.events[event] = param.events[event];\n              }\n            }\n          }\n          else if (name === \"ref\") {\n            this.ref       = param[name];\n            this.attrs.ref = param[name];\n          }\n          else if (name === \"cn\") {\n            // A bit of magic for the \"class\" attribute: cn -> class\n            // We also will append to the class if there already is one\n            if (this.attrs['class']) {\n              this.attrs['class'] += \" \" + param[name];\n            }\n            else {\n              this.attrs['class'] = param[name];\n            }\n          }\n          else if (param[name] !== \"\"){\n            this.attrs[name] = param[name];\n          }\n        }\n      }\n      else if (type === \"undefined\") {\n        // skip\n      }\n      else if (param.toString) {\n        this.contents.push({type: \"textnode\", value: param.toString()});\n      }\n      else {\n        console.warn(\"Unknown JstElement parameter type: \", type);\n      }\n    }\n  }\n\n\n  // This will manage any CSS that should be injected on behalf of\n  // the JstObject passed in\n  _processCss(jstObj, css) {\n    if (css) {\n      jst.styleManager.updateCss(jstObj, css);\n    }\n  }\n\n\n  // Some helpers\n  _quoteAttrValue(value) {\n    return value.replace ? value.replace(/\"/, '\\\"') : value;\n  }\n\n}\n\n\njst.fn = jst.prototype = {};\n\n\n// Shrunken version of jQuery's extend\njst.extend = jst.fn.extend = function() {\n  let target = this;\n  let length = arguments.length;\n\n  for (let i = 0; i < length; i++) {\n    let options;\n    if ((options = arguments[i]) !== null) {\n      for (let name in options) {\n        let copy = options[name];\n\n        // Prevent never-ending loop\n        if (target === copy) {\n          continue;\n        }\n\n        if (copy !== undefined) {\n          target[name] = copy;\n        }\n      }\n    }\n  }\n\n  // Return the modified object\n  return target;\n};\n\n\njst.extend({\n  debug:     false,\n  tagPrefix: \"$\",\n  Object:    JstObject,\n  Form:      JstFormManager,\n  Element:   JstElement,\n  tags: [\n    'a', 'abbr', 'address', 'area', 'article', 'aside', 'audio', 'b', 'base',\n    'bdi', 'bdo', 'blockquote', 'body', 'br', 'button', 'canvas', 'caption',\n    'cite', 'code', 'col', 'colgroup', 'command', 'data', 'datalist', 'dd',\n    'del', 'details', 'dfn', 'div', 'dl', 'dt', 'em', 'embed', 'fieldset',\n    'figcaption', 'figure', 'footer', 'form', 'h1', 'h2', 'h3', 'h4', 'h5',\n    'h6', 'head', 'header', 'hgroup', 'hr', 'html', 'i', 'iframe', 'img', 'input',\n    'ins', 'kbd', 'keygen', 'label', 'legend', 'li', 'link', 'main', 'map', 'mark', 'math',\n    'menu', 'meta', 'meter', 'nav', 'noscript', 'object', 'ol', 'optgroup', 'option',\n    'output', 'p', 'param', 'pre', 'progress', 'q', 'rp', 'rt', 'ruby', 's',\n    'samp', 'script', 'section', 'select', 'small', 'source', 'span', 'strong',\n    'style', 'sub', 'summary', 'sup', 'svg', 'table', 'tbody', 'td', 'textarea',\n    'tfoot', 'th', 'thead', 'time', 'title', 'tr', 'track', 'u', 'ul', 'var',\n    'video', 'wbr','altGlyph','altGlyphDef','altGlyphItem','animate','animateColor','animateMotion',\n    'animateTransform','circle','clipPath','color-profile','cursor','defs','desc','discard',\n    'ellipse','feBlend','feColorMatrix','feComponentTransfer','feComposite','feConvolveMatrix',\n    'feDiffuseLighting','feDisplacementMap','feDistantLight','feDropShadow','feFlood','feFuncA',\n    'feFuncB','feFuncG','feFuncR','feGaussianBlur','feImage','feMerge','feMergeNode','feMorphology',\n    'feOffset','fePointLight','feSpecularLighting','feSpotLight','feTile','feTurbulence','filter',\n    'font','font-face','font-face-format','font-face-name','font-face-src','font-face-uri',\n    'foreignObject','g','glyph','glyphRef','hatch','hatchpath','hkern','image','line',\n    'linearGradient','marker','mask','mesh','meshgradient','meshpatch','meshrow','metadata',\n    'missing-glyph','mpath','path','pattern','polygon','polyline','radialGradient','rect','script',\n    'set','solidcolor','stop','style','svg','switch','symbol','text','textPath','title','tref',\n    'tspan','unknown','use','view','vkern'\n  ],\n  cssFuncs: [\n    'attr', 'calc', 'cubic-bezier', 'hsl', 'hsla', 'linear-gradient',\n    'radial-gradient', 'repeating-linear-gradient', 'repeating-radial-gradient',\n    'rgb', 'rgba', 'var', 'translate', 'matrix', 'matrix3d', 'translate', 'translate3d',\n    'translateX', 'translateY', 'translateZ', 'scale', 'scale3d', 'scaleX', 'scaleY',\n    'scaleZ', 'rotate', 'rotate3d', 'rotateX', 'rotateY', 'rotateZ', 'skew', 'skewX',\n    'skewY', 'perspective'\n  ],\n  cssUnits: [\n    'cm', 'mm', 'in', 'px', 'pt', 'pc', 'em', 'ex', 'ch', 'rem', 'vw', 'vh',\n    'vmin', 'vmax', 'deg', 'rad', 's'\n  ],\n  \n  // If there are some new elements that you want to insert into the DOM that\n  // aren't in the hardcoded list above, then you can add them with this\n  // (raise a github issue too, so they can be added to the list if they are\n  // generally useful)\n  addCustomElements: function() {\n    let names = jst._flatten.apply(this, arguments);\n\n    for (let name of names) {\n      let fullName = jst.tagPrefix + name;\n      jst[fullName] = function() {\n        let args = jst._flatten.apply(this, arguments);\n        return (new JstElement(name, args));\n      };\n    }\n  },\n\n  addCssFunctions: function() {\n    let names = jst._flatten.apply(this, arguments);\n    for (let name of names) {\n      let camelName = name.replace(/-([a-z])/g, match => match[1].toUpperCase());\n      jst[camelName] = function() {\n        let args = jst._flatten.apply(this, arguments);\n        return `${name}(${args.join(\",\")})`;\n      };\n    }\n  },\n\n  addCssUnits: function() {\n    let names = jst._flatten.apply(this, arguments);\n    for (let name of names) {\n      jst[name] = function() {\n        let args = jst._flatten.apply(this, arguments);\n        let fixed = args.map(arg => `${arg}${name}`);\n        return fixed.join(\" \") + \" \";\n      };\n    }\n  },\n\n  // Used to associate a generic object with JST so that it can be used\n  // as a refreshable datasource for a template\n  object: function(obj) {\n    if (typeof(obj) != \"object\") {\n      throw(new Error(\"You must pass an object to jst.object()\"));\n    }\n    return obj.$jst = new JstObject(obj);\n  },\n\n  // Put all the element functions (e.g. $div(), $span()) in the global (window)\n  // namespace\n  makeGlobal: function(prefix) {\n    jst.global          = true;\n    jst.globalTagPrefix = prefix || jst.tagPrefix;\n    for (let tag of jst.tags) {\n      let name = jst.globalTagPrefix + tag;\n      let g = typeof global !== 'undefined' ? global : window;\n      g[name] = function() {\n        return jst[name].apply(this, arguments);\n      };\n    }\n  },\n\n  // Check passed in value to see if it is of interest in the following way:\n  //   - is it defined at all?\n  //   - if it is an array, does it have any values?\n  //   - if it is an object, does it have properties?\n  //   - if it is a number, always return true\n  // If the checks fail, then return ifFalse or undefined, otherwise return ifTrue || true\n  //\n  // This can be used to prefix rendering blocks with jst.if(val) && ..., e.g.:\n  //    render() {\n  //      // this works because 'undefined' is silently skipped in Jayesstee\n  //      return jst.if(myList) && jst.$ul(myList.map(item => jst.$li(item)))\n  //    }\n  // or if you prefer, you can do a tertiary expression: jst.if(val) ? ... : ...\n  //\n  // Note that if you pass in a boolean, 'false' will return 'undefined' and 'true'\n  // will return 'true'\n  if: function(val, ifTrue, ifFalse) {\n    ifTrue = ifTrue || true;\n    let type = typeof(val);\n    if (type === \"number\") {\n      return ifTrue;\n    }\n    if (type === \"undefined\" || val === null) {\n      return ifFalse;\n    }\n    if (Array.isArray(val)) {\n      return val.length ? ifTrue : ifFalse;\n    }\n    if (type === \"object\") {\n      return Object.keys(val).length === 0 && val.constructor === Object ? ifFalse : ifTrue;\n    }\n\n    // Catch all including boolean type\n    return val ? ifTrue : ifFalse;\n    \n  },\n\n  // Control debug behaviour - with debug on, jayesstee will include\n  // additional elements in the DOM to make it much easier to debug the\n  // heirarchy\n  setDebug: function(val) {\n    jst.debug = val;\n  },\n\n  //\n  // Internal functions\n  //\n  // Called automatically\n  _init: function() {\n    jst.addCustomElements(jst.tags);\n    jst.addCssFunctions(jst.cssFuncs);\n    jst.addCssUnits(jst.cssUnits);\n    jst.styleManager = new JstStyleManager();\n    if (typeof window !== 'undefined') {\n      jst(\"head\").appendChild(jst.styleManager);\n    }\n    else {\n      global.HTMLElement = class HTMLElement {};\n    }\n  },\n\n  _addCssUnit: function(unit, val) {\n    if (typeof(val) === \"number\") {\n      return `${val}${unit || \"\"}`;\n    }\n    return val && val.toString ? val.toString() : val;\n  },\n\n  _flatten: function() {\n    var flat = [];\n    for (var i = 0; i < arguments.length; i++) {\n      if (arguments[i] instanceof Array) {\n        flat.push.apply(flat, jst._flatten.apply(this, arguments[i]));\n      }\n      else if (arguments[i] instanceof Function) {\n        let result = arguments[i]();\n        if (result instanceof Array) {\n          flat.push.apply(flat, jst._flatten.apply(this, result));\n        }\n        else {\n          flat.push(result);\n        }\n      }\n      else {\n        flat.push(arguments[i]);\n      }\n    }\n    return flat;\n  },\n\n  _normalizeCss: function(input) {\n    // First flatten the top level\n    let flat = jst._flatten(input);\n    let evenFlatter = [];\n    \n    // We should now have a single array that could have objects or values\n    flat.map(entry => {\n      if (entry instanceof Object) {\n        evenFlatter = evenFlatter.concat(jst._normalizeCssObject(entry));\n      }\n      else {\n        evenFlatter.push(entry);\n      }\n    });\n    return evenFlatter;\n  },\n\n  _normalizeCssObject: function(obj) {\n    const atRules = new Set([\"$media\", \"$keyframes\", \"$supports\", \"$page\",\n                             \"$fontFace\", \"$viewport\", \"$counterStyle\",\n                             \"$fontFeatureValues\", \"$swash\", \"$ornaments\",\n                             \"$stylistic\", \"$styleset\", \"$characterVariant\"]);\n    let fixed = [];\n    \n    for (let prop of Object.keys(obj)) {\n\n      let sel;\n      let fixedSetting = {};\n      \n      if (atRules.has(prop)) {\n        let processed = this._normalizeCssObject(obj[prop]);\n        sel = prop.replace(/^\\$/, \"@\").replace(/([A-Z])/g, m => \"-\"+m.toLowerCase());\n        processed.map(item => fixedSetting = Object.assign(fixedSetting, item));\n      }\n      else {\n        \n        let parts = prop.split(\"$\");\n        sel       = parts.shift();\n        for (let part of parts) {\n          if (part === \"c\") {\n            sel = `.${sel}`;\n          }\n          else if (part === \"i\") {\n            sel = `#${sel}`;\n          }\n          else {\n            sel = `${sel}:${part}`;\n          }\n        }\n\n        \n        let setting = jst._flatten(obj[prop]);\n        setting.map(val => {\n          if (val instanceof Object) {\n            fixedSetting = Object.assign(fixedSetting, jst._normalizeCssStyles(val));\n          }\n          else {\n            fixedSetting = val;\n          }\n        });\n\n      }\n      \n      let tmpObj = {};\n      tmpObj[sel] = fixedSetting;\n      fixed.push(tmpObj);\n    }\n    return fixed;\n  },\n\n  _normalizeCssStyles: function(obj) {\n    let fixed = {};\n    for (let prop of Object.keys(obj)) {\n      let val = obj[prop];\n      if (val instanceof Object && !Array.isArray(val)) {\n        if (val.rgb && val.rgb().string) {\n          fixed[prop] = val.rgb().string();\n        }\n        else {\n          let fixedObj = this._normalizeCssStyles(obj[prop]); \n          fixed[prop] = [fixedObj];\n        }\n      }\n      else {\n        let val   = jst._flatten(obj[prop]);\n        let match = prop.match(/^([^$]+)\\$(.+)/);\n        if (match) {\n          val = val.map(item => jst._addCssUnit(match[2], item));\n          fixed[match[1]] = val;\n        }\n        else {\n          fixed[prop] = val;\n        }\n      }\n    }\n    return fixed;\n  }\n  \n\n});\n\njst._init();\n\n"]}